<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script src="https://sdk.accountkit.com/en_US/sdk.js"></script>

    <script>
      // initialize Account Kit with CSRF protection
      AccountKit_OnInteractive = function() {
        AccountKit.init({
          appId: '450640655668044',
          state: '55262304ad4a1e1d4eb78fa2d40e8c75',
          version: 'v1.1',
          fbAppEventsEnabled: true,
          redirect: 'https://quynguyen-tech.github.io/module3-solution/'
        })
      }

      // login callback
      function loginCallback(response) {
        if (response.status === 'PARTIALLY_AUTHENTICATED') {
          var code = response.code
          var csrf = response.state
          // Send code to server to exchange for access token
        } else if (response.status === 'NOT_AUTHENTICATED') {
          // handle authentication failure
        } else if (response.status === 'BAD_PARAMS') {
          // handle bad parameters
        }
      }

      // phone form submission handler
      function smsLogin() {
        var countryCode = document.getElementById('country_code').value
        var phoneNumber = document.getElementById('phone_number').value
        AccountKit.login(
          'PHONE',
          { countryCode: countryCode, phoneNumber: phoneNumber }, // will use default values if not specified
          loginCallback
        )
      }

      // email form submission handler
      function emailLogin() {
        var emailAddress = document.getElementById('email').value
        AccountKit.login('EMAIL', { emailAddress: emailAddress }, loginCallback)
      }
    </script>
  </head>
  <body>
    <input value="+1" id="country_code" />
    <input placeholder="phone number" id="phone_number" />
    <button onclick="smsLogin();">Login via SMS</button>
    <div>OR</div>
    <input placeholder="email" id="email" />
    <button onclick="emailLogin();">Login via Email</button>

    <form id="login_success" method="post" action="/login_success.php">
      <input id="csrf" type="hidden" name="csrf" />
      <input id="code" type="hidden" name="code" />
    </form>

    <script>
      function loginCallback(response) {
        if (response.status === 'PARTIALLY_AUTHENTICATED') {
          document.getElementById('code').value = response.code
          document.getElementById('csrf').value = response.state
          document.getElementById('login_success').submit()
        }
      }
    </script>
  </body>
</html>
